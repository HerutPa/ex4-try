<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      lang="en" dir="ltr"
      th:replace="fragments/layout :: content(~{::section}, 'Edit Skills')">

<section>
    <!-- CSS ×¡×¤×¦×™×¤×™ ×œ×¢×ž×•×“ (×¨×§ ×ž×”×¤×¨×’×ž× ×˜ ×”×§×™×™×) -->
    <div th:replace="fragments/style :: editSkillsStyles"></div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div>
                <h1 class="page-title">Edit Skills</h1>
                <p class="subtitle">Update your professional skills</p>
            </div>
            <a th:href="@{/user/home}" class="btn btn-primary">Homepage</a>
        </div>

        <!-- ×ª×•×›×Ÿ -->
        <div class="panel">
            <div th:if="${msg}" class="alert" th:text="${msg}"></div>
            <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

            <div class="panel" style="margin-top:12px;">
                <div style="color:#ffef9c; font-weight:900; margin-bottom:6px;">ðŸ’¡ Tip</div>
                <div class="hint">
                    You can combine: select skills from the list and also add new ones in free text. Everything will be saved together.
                </div>
            </div>

            <form th:action="@{/user/profile/edit}" th:object="${form}" method="post" style="margin-top:12px;">
                <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                <div class="panel">
                    <div class="skills-head">
                        <h3 style="color:#fff; margin:0; font-weight:900;">Select skills from the list</h3>
                        <div id="selectedCount" class="selected-count">0 selected</div>
                    </div>

                    <div class="skills-grid" id="skillsGrid" th:if="${allSkills != null}">
                        <div th:each="skill : ${allSkills}" class="skill-checkbox"
                             th:classappend="${form != null and form.skills != null and #lists.contains(form.skills, skill.name)} ? ' checked'">
                            <!-- ×¢× binding ×›×©×™×© form -->
                            <input type="checkbox"
                                   th:if="${form != null}"
                                   th:id="'skill-' + ${skill.id}"
                                   th:value="${skill.name}"
                                   th:field="*{skills}"
                                   onchange="updateCount(this)"/>
                            <!-- fallback ×‘×œ×™ binding ×›×©××™×Ÿ form -->
                            <input type="checkbox"
                                   th:unless="${form != null}"
                                   th:id="'skill-' + ${skill.id}"
                                   th:value="${skill.name}"
                                   name="skills"
                                   onchange="updateCount(this)"/>
                            <label th:for="'skill-' + ${skill.id}" th:text="${skill.name}">Skill</label>
                        </div>
                    </div>

                    <div th:if="${allSkills == null or #lists.isEmpty(allSkills)}" class="hint">
                        No skills to show yet.
                    </div>
                </div>

                <div class="divider">and / or</div>

                <div class="panel">
                    <h3 style="color:#fff; margin:0 0 8px; font-weight:900;">Add new skills</h3>

                    <label th:for="${form != null} ? 'freeTextInput' : 'freeTextInput_fallback'"
                           style="color:#fff; font-weight:700; margin-bottom:6px; display:block;">
                        New skills (separated by commas or semicolons):
                    </label>

                    <!-- ×›×©×™×© form: binding -->
                    <input id="freeTextInput" class="form-control"
                           type="text"
                           th:if="${form != null}"
                           th:field="*{freeTextSkills}"
                           placeholder="e.g.: Python, Docker, Kubernetes" />

                    <!-- ×›×©××™×Ÿ form: fallback ×¢× id ×©×•× ×” -->
                    <input id="freeTextInput_fallback" class="form-control"
                           type="text"
                           th:unless="${form != null}"
                           name="freeTextSkills"
                           placeholder="e.g.: Python, Docker, Kubernetes" />

                    <div class="hint">Write several skills separated by commas. New skills will be added alongside the list selections.</div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                    <a th:href="@{/user/home}" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>

    <script th:inline="javascript">
        function updateCount(chk){
            const parent = chk.closest('.skill-checkbox');
            if(parent){ parent.classList.toggle('checked', chk.checked); }
            const count = document.querySelectorAll('#skillsGrid input[type="checkbox"]:checked').length;
            const el = document.getElementById('selectedCount');
            if(el){ el.textContent = count + ' selected'; }
        }
        document.addEventListener('DOMContentLoaded', function(){
            const boxes = document.querySelectorAll('#skillsGrid input[type="checkbox"]');
            let c = 0;
            boxes.forEach(b=>{
                if(b.checked){ b.closest('.skill-checkbox')?.classList.add('checked'); c++; }
            });
            const el = document.getElementById('selectedCount');
            if(el){ el.textContent = c + ' selected'; }
        });
    </script>
</section>
</html>
