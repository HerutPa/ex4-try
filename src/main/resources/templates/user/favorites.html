<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      lang="en" dir="ltr"
      th:replace="fragments/layout :: content(~{::section}, 'My Favorite Jobs')">

<section>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 class="page-title">⭐ My Favorite Jobs</h1>
            <a th:href="@{/user/home}" class="btn btn-primary">Homepage</a>
        </div>

        <!-- Stats -->
        <div th:if="${favoritesCount != null && favoritesCount > 0}"
             class="alert alert-success">
            You have <strong th:text="${favoritesCount}">0</strong> Favorite Jobs
        </div>

        <!-- Favorites Grid -->
        <div th:if="${!page.content.isEmpty()}" class="jobs-grid">
            <div th:each="job : ${page.content}" class="job-card">
                <!-- TOP: logo + title/company + badge -->
                <div class="card-top">
                    <div class="card-left">
                        <div class="brand-dot" aria-hidden="true"></div>

                        <div class="title-wrap">
                            <div class="card-title">
                                <a th:href="@{|/jobs/${job.id}|}" th:text="${job.title}">Job Title</a>
                            </div>
                            <div class="company-line" th:text="${job.company} ?: 'Company'">Company</div>
                        </div>
                    </div>

                    <span th:if="${job.category != null}" class="badge"
                          th:text="${job.category.name}">Category</span>
                </div>

                <!-- META -->
                <div class="meta-row">
          <span th:if="${job.location}" class="meta-chip">
            <i class="fa-solid fa-location-dot"></i>
            <span th:text="${job.location}">Location</span>
          </span>

                    <span th:if="${job.salaryMin != null || job.salaryMax != null}" class="meta-chip">
            <i class="fa-solid fa-shekel-sign"></i>
            <span>
              <span th:if="${job.salaryMin != null}"
                    th:text="${#numbers.formatInteger(job.salaryMin,0,'COMMA')}">Min</span>
              <span th:if="${job.salaryMin != null && job.salaryMax != null}"> – </span>
              <span th:if="${job.salaryMax != null}"
                    th:text="${#numbers.formatInteger(job.salaryMax,0,'COMMA')}">Max</span>
              <span>₪</span>
            </span>
          </span>

                    <span class="meta-chip">
            <i class="fa-regular fa-calendar"></i>
            <span th:text="${#temporals.format(job.createdAt, 'dd/MM/yyyy')}">Date</span>
          </span>
                </div>

                <!-- DESCRIPTION -->
                <div class="card-desc" th:text="${job.description}">
                    Job description...
                </div>

                <!-- ACTIONS -->
                <div class="card-bottom">
                    <span class="pill">Favorite</span>

                    <div style="display:flex; gap:8px;">
                        <a th:href="@{|/jobs/${job.id}|}" class="view-btn">
                            <span>View Details</span>
                            <i class="fa-solid fa-arrow-left"></i>
                        </a>

                        <!-- כפתור הסרה מהמועדפים (נראה כמו כפתור משני) -->
                        <button class="view-btn" style="background:#e74c3c; box-shadow:none;"
                                th:data-job-id="${job.id}"
                                onclick="removeFavorite(this)">
                            <i class="fa-solid fa-trash"></i>
                            Remove
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div th:if="${page.content.isEmpty()}" class="empty-state">
            <h2>No favorite jobs yet</h2>
            <p>Start following jobs that interest you!</p>
            <a th:href="@{/jobs}" class="page-btn" style="display:inline-block;">
                Browse Jobs
            </a>
        </div>

        <!-- Pagination -->
        <div th:if="${page.totalPages > 1}" class="pagination">
            <div class="pagination-info">
                Page <strong th:text="${page.number + 1}">1</strong>
                of <strong th:text="${page.totalPages}">1</strong> |
                Total <strong th:text="${page.totalElements}">0</strong> Jobs
            </div>
            <div class="pagination-buttons">
                <a th:if="${page.hasPrevious()}"
                   th:href="@{/user/favorites(size=${page.size}, page=${page.number - 1})}"
                   class="page-btn">← Previous</a>

                <a th:if="${page.hasNext()}"
                   th:href="@{/user/favorites(size=${page.size}, page=${page.number + 1})}"
                   class="page-btn">Next →</a>
            </div>
        </div>
    </div>

    <!-- ה־footer נטען מה־layout, אין צורך לכלול כאן -->
    <script th:inline="javascript">
        const csrfToken = /*[[${_csrf.token}]]*/ '';
        const csrfHeader = /*[[${_csrf.headerName}]]*/ '';

        function removeFavorite(button) {
            if (!confirm('Remove this job from favorites?')) return;
            const jobId = button.getAttribute('data-job-id');

            fetch(`/jobs/${jobId}/favorite`, {
                method: 'POST',
                headers: { [csrfHeader]: csrfToken }
            })
                .then(res => res.json())
                .then(data => { if (data.success) location.reload(); })
                .catch(err => {
                    console.error('Error removing favorite:', err);
                    alert('Error removing job');
                });
        }
    </script>
</section>
</html>
